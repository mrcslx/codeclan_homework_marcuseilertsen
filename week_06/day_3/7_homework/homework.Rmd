---
title: "Homework - CIs"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    df_print: paged
    css: ../../../styles.css
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = 'center')
```

<hr>

# MVP

Now we'll go back to CI creation in the normal fashion. We'll take the `ames` data from the CIs lab earlier today and regard it now as a **sample**, we won't be drawing any smaller samples from within it. This is the usual situation in an analysis: you use all the data available to you!

<br>

**Task 1.**  
Load the data again, `clean_names()`, and re-familiarise yourself with it

<br>

```{r}
library(tidyverse)
library(janitor)
library(infer)
```

```{r}
ames <- read_csv(here::here("data/ames.csv")) %>% 
  clean_names()
```


**Task 2.**  
Investigate the distribution of `lot_area`. Is the distribution roughly normal? If not, what problems do you find?

<br>

```{r}
ames %>% 
  ggplot() +
  aes(x = lot_area) +
  geom_histogram(col = "white", fill = "orange", alpha = 0.7)
```

The data appears to be right-skewed, there seems to be a long tail with some outliers, but it is difficult to tell from that plot.


**Task 3.**  
Compute and visualise a bootstrap sampling distribution for the `mean(lot_area)` of the sold houses.

<br>

```{r}
infer_ames_resample <- ames %>%
  specify(response = lot_area) %>%
  generate(reps = 5000, type = "bootstrap") %>%
  calculate(stat = "mean")
```

```{r}
infer_ames_resample %>% 
  ggplot() +
  aes(x = stat) +
  geom_histogram(col = "white", fill = "orange", alpha = 0.7) +
  labs(x = "mean(lot_area)")

infer_ames_resample %>% 
  visualise(bins = 30)
```


**Task 4.**  
Use your bootstrap distribution to calculate a $95\%$ CI for `mean(lot_area)`, and visualise it on the distribution

<br>

```{r}
infer_ci_95 <- infer_ames_resample %>% 
  get_confidence_interval(level = 0.95, type = "percentile")
infer_ci_95
```

```{r}
infer_ames_resample %>% 
  visualise(bins = 30) +
  shade_confidence_interval(endpoints = infer_ci_95)
```


**Task 5.**  
You would like to know the `mean(lot_area)` of the sold houses with higher confidence. Calculate the $99\%$ CI for this variable (you can re-use your bootstrap distribution from above). Is it narrower or broader than the $95\%$ CI? Does that make sense?

<br>

```{r}
infer_ci_99 <- infer_ames_resample %>% 
  get_confidence_interval(level = 0.99, type = "percentile")
infer_ci_99
```

The 99% CI is broader than the 95% CI, which makes sense as we would expect more of our values to be caught in the 99% CI.


**Task 6.**  
Calculate the point estimate of the `mean(lot_area)`

<hr>

```{r}
mean_infer <- infer_ames_resample %>% 
  summarise(mean = mean(stat))
mean_infer
```


# Extension

<br>

**Task 1.**  
Calculate a point estimate and $95\%$ CI for the proportion of houses in the data built before 1920.  Does the number of `reps` you use matter? [Investigate `reps` from $200$ up to $50000$, memory of your laptop permitting].
<br><br>

```{r}
infer_ames_resample_200 <- ames %>%
  filter(year_built < 1920) %>% 
  specify(response = lot_area) %>%
  generate(reps = 200, type = "bootstrap") %>%
  calculate(stat = "mean")
```

```{r}
infer_200_ci_95 <- infer_ames_resample_200 %>% 
  get_confidence_interval(level = 0.95, type = "percentile")
infer_200_ci_95
```

```{r}
mean_infer_200 <- infer_ames_resample_200 %>% 
  summarise(mean = mean(stat))
mean_infer_200
```



```{r}
infer_ames_resample_1000 <- ames %>%
  filter(year_built < 1920) %>% 
  specify(response = lot_area) %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "mean")
```

```{r}
infer_1000_ci_95 <- infer_ames_resample_1000 %>% 
  get_confidence_interval(level = 0.95, type = "percentile")
infer_1000_ci_95
```

```{r}
mean_infer_1000 <- infer_ames_resample_1000 %>% 
  summarise(mean = mean(stat))
mean_infer_1000
```



```{r}
infer_ames_resample_10000 <- ames %>%
  filter(year_built < 1920) %>% 
  specify(response = lot_area) %>%
  generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "mean")
```

```{r}
infer_10000_ci_95 <- infer_ames_resample_10000 %>% 
  get_confidence_interval(level = 0.95, type = "percentile")
infer_10000_ci_95
```

```{r}
mean_infer_10000 <- infer_ames_resample_10000 %>% 
  summarise(mean = mean(stat))
mean_infer_10000
```



```{r}
infer_ames_resample_50000 <- ames %>%
  filter(year_built < 1920) %>% 
  specify(response = lot_area) %>%
  generate(reps = 50000, type = "bootstrap") %>%
  calculate(stat = "mean")
```

```{r}
infer_50000_ci_95 <- infer_ames_resample_50000 %>% 
  get_confidence_interval(level = 0.95, type = "percentile")
infer_50000_ci_95
```

```{r}
mean_infer_50000 <- infer_ames_resample_50000 %>% 
  summarise(mean = mean(stat))
mean_infer_50000
```

We investigated the data using 200, 1000, 10000 and 50000 reps. The point estimate and 95% CI are very similar and do not seem to follow any kind of pattern. The number of reps used in this case does not seem to matter all that much.